<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Q.I. Víctor Soto Del Toro">

<title>La necesidad de comprimir datos en control estadístico multivariable</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-80e8053d18074af87c7f30c83ce2475b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://www.linkedin.com/in/qivictorsotodeltoro/" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.png" alt="Analítica Multivariable – por Víctor Soto" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./introduccion.html"> 
<span class="menu-text">¿Análisis Multivariable para Procesos Industriales?</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./marco_teorico.html"> 
<span class="menu-text">Control Estadístico de Procesos Fisicoquímicos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./metodologiayfundamentos.html" aria-current="page"> 
<span class="menu-text">Metodología y Fundamentos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./referencias.html"> 
<span class="menu-text">Referencias y Fuentes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./acerca.html"> 
<span class="menu-text">Acerca de</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">La necesidad de comprimir datos en control estadístico multivariable</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Inicio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Diagnóstico Compuesto</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parcoord.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1 Gráfico Coordinado Paralelo</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Diagnóstico T² y Q</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T2_Q.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.1 Exploración General T² vs Q</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./T2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.2 Hotelling T²</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Q.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.3 Jackson Q / SPE</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Contribuciones t y q</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contribuciones1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.1 Observación 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contribuciones2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.2 Observación 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contribuciones3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.3 Observación 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contribuciones4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.4 Observación 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contribuciones5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.5 Observación 5</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">La necesidad de comprimir datos en control estadístico multivariable</h1>
</div>



<div class="quarto-title-meta column-page-right">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Q.I. Víctor Soto Del Toro </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="nota-la-siguiente-disertación-no-pretende-de-ninguna-manera-sustituir-el-cuerpo-formal-de-conocimientos-existente-en-este-campo.-su-propósito-es-introducir-al-lector-no-experimentado-en-la-terminología-la-simbología-y-la-lógica-que-explican-y-sustentan-estos-procedimientos." class="level6">
<h6 class="anchored" data-anchor-id="nota-la-siguiente-disertación-no-pretende-de-ninguna-manera-sustituir-el-cuerpo-formal-de-conocimientos-existente-en-este-campo.-su-propósito-es-introducir-al-lector-no-experimentado-en-la-terminología-la-simbología-y-la-lógica-que-explican-y-sustentan-estos-procedimientos."><strong>NOTA:</strong> La siguiente disertación no pretende, de ninguna manera, sustituir el cuerpo formal de conocimientos existente en este campo. Su propósito es introducir al lector no experimentado en la terminología, la simbología y la lógica que explican y sustentan estos procedimientos.</h6>
</section>
<section id="aunque-el-texto-es-riguroso-desde-el-punto-de-vista-matemático-y-metodológico-no-es-exhaustivo-por-razones-de-espacio-y-de-propósito.-los-libros-de-texto-existen-precisamente-para-cubrir-ese-nivel-de-detalle." class="level6">
<h6 class="anchored" data-anchor-id="aunque-el-texto-es-riguroso-desde-el-punto-de-vista-matemático-y-metodológico-no-es-exhaustivo-por-razones-de-espacio-y-de-propósito.-los-libros-de-texto-existen-precisamente-para-cubrir-ese-nivel-de-detalle.">Aunque el texto es riguroso desde el punto de vista matemático y metodológico, no es exhaustivo por razones de espacio y de propósito. Los libros de texto existen precisamente para cubrir ese nivel de detalle.</h6>
</section>
<section id="se-exhorta-al-lector-interesado-a-consultar-y-estudiar-con-detenimiento-las-fuentes-y-referencias-especializadas-si-desea-profundizar-en-los-fundamentos-teóricos-que-respaldan-estos-métodos." class="level6">
<h6 class="anchored" data-anchor-id="se-exhorta-al-lector-interesado-a-consultar-y-estudiar-con-detenimiento-las-fuentes-y-referencias-especializadas-si-desea-profundizar-en-los-fundamentos-teóricos-que-respaldan-estos-métodos.">Se exhorta al lector interesado a consultar y estudiar con detenimiento las fuentes y referencias especializadas si desea profundizar en los fundamentos teóricos que respaldan estos métodos.</h6>
</section>
<section id="comprimir-datos" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="comprimir-datos"><span class="header-section-number">1</span> ¿Comprimir Datos?</h2>
<p>En una sección anterior se mencionó que para ser construidos y aplicados de manera confiable, los <strong>modelos empíricos multivariables</strong> requieren <strong>grandes cantidades de datos comprimibles</strong>.</p>
<p>Antes de iniciar, conviene preguntarnos: ¿qué sucede al trabajar formalmente con datos, particularmente cuando son multivariables?</p>
<p>El propósito es tomar decisiones acertadas. Para ello, existen dos submetodologías:</p>
<ol type="1">
<li>El análisis estadístico (o algorítmico) de los datos.</li>
<li>El análisis gráfico de los datos.</li>
</ol>
<p>Ambas trabajan juntas y para que cumplamos el sentido formal, deben aplicarse en ese orden.</p>
<p>Sin embargo, incluso antes de analizar cualquier conjunto de números y variables, existe un requisito previo que debemos satisfacer y podemos formularlo con una pregunta: ¿cuál es el fundamento metodológico que debemos seguir y respetar para que nuestra labor analítica sea científicamente válida?</p>
<p>O en términos más coloquiales: ¿cómo vamos a proceder y por qué elegimos hacerlo de esa manera?</p>
<p>En el caso concreto de la construcción de procedimientos de control estadístico para procesos fisicoquímicos multivariables, el mecanismo formal ya existe desde hace décadas. Y todo comienza con una tabla de datos que pueden estar conformados por un gran número de <strong>observaciones</strong> ( <span class="math inline">\(N\)</span> ), un gran número de <strong>variables por observación</strong> (<span class="math inline">\(M\)</span> ), o por ambos simultáneamente. En el caso de los procesos fisicoquímicos industriales, el número de variables <span class="math inline">\(M\)</span> por observación puede variar desde unas cuantas hasta <strong>decenas o incluso cientos</strong>.</p>
<p>Cuando el número de variables es elevado, surgen <strong>dificultades tanto logísticas como matemáticas</strong> al trabajar con datos multivariables. Desde el punto de vista operativo, aumenta la complejidad del almacenamiento, la visualización y la interpretación de la información. Desde el punto de vista matemático, aparecen problemas asociados a la correlación, la redundancia y la inestabilidad numérica de los modelos.</p>
<p>La <strong>compresión de datos</strong> es el proceso mediante el cual un conjunto de datos de alta dimensionalidad se transforma en una representación que utiliza <strong>menos variables</strong>, pero que conserva, en forma condensada, la mayor parte de la información relevante. Desde una perspectiva estadística, una representación comprimida reduce el número de variables, <strong>requiere menos almacenamiento</strong> y <strong>consume menos recursos computacionales</strong>. Desde una perspectiva analítica, permite <strong>filtrar información irrelevante, redundante o indeseada</strong>, facilitando el desempeño de las técnicas de modelación que se aplican posteriormente.</p>
<p>Existen múltiples métodos de compresión de datos utilizados en distintas áreas técnicas, como las <strong>transformadas de Fourier</strong>, las <strong>wavelets</strong> y métodos afines, ampliamente empleados en espectroscopía, cromatografía y otros problemas analíticos específicos.</p>
<p>Sin embargo, existe un tipo particular de compresión de datos que se ha convertido en el <strong>fundamento de los métodos quimiométricos</strong> y que resulta especialmente ventajoso para el <strong>control estadístico de procesos fisicoquímicos multivariables</strong>: el <strong>Análisis de Componentes Principales (PCA)</strong>.</p>
</section>
<section id="los-detalles-de-pca" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="los-detalles-de-pca"><span class="header-section-number">2</span> Los detalles de PCA</h2>
<p>La siguiente terminología y vocabulario pueden resultar nuevos para algunos lectores. Eso está bien porque esta lectura es para ellos y no para especialistas experimentados que la pueden encontrar básica, elemental y aburrida.</p>
<p>PCA es un método de compresión de datos que se considera rutinario y elemental en estadística multivariable. ¿Qué nos ofrece? Lo que hace es reducir un conjunto de datos obtenido a partir de <span class="math inline">\(M\)</span> variables medidas a lo largo de <span class="math inline">\(N\)</span> observaciones. Esta reducción consiste en producir una representación más simple que, en muchos casos, utiliza un número mucho menor de “variables comprimidas” ( <span class="math inline">\(A≪M\)</span>). En algunos casos la compresión es limitada ( <span class="math inline">\(A&lt;M\)</span> ) y esto es una clara señal de que el control no será alcanzable y la causa es solo una: el proceso no es repetible y la falta de compresión suficiente es evidencia de ello. Si el proceso estuviera en control, los datos se comprimirían.</p>
<p>Estas variables comprimidas reciben el nombre de <strong>componentes principales</strong> (PCs).</p>
<p>La formulación matemática estándar de PCA se expresa como:</p>
<section id="boldsymbolx-tpt-e-donde" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="boldsymbolx-tpt-e-donde"><span class="header-section-number">2.1</span> <span class="math display">\[ \boldsymbol{X = TP^t + E} \]</span>Donde:</h3>
<ul>
<li><p><span class="math inline">\(\boldsymbol{X}\)</span> es la matriz de datos original de dimensiones <span class="math inline">\(N×M\)</span></p></li>
<li><p><span class="math inline">\(\boldsymbol{T}\)</span> es una matriz <span class="math inline">\(N×A\)</span> que contiene los <em>scores</em> de los componentes principales</p></li>
<li><p><span class="math inline">\(\boldsymbol{P}\)</span> es una matriz <span class="math inline">\(M×A\)</span> que contiene los <em>loadings</em> de los componentes principales</p></li>
<li><p><span class="math inline">\(\boldsymbol{E}\)</span> es una matriz <span class="math inline">\(N×M\)</span> de residuales</p></li>
</ul>
<p>Para el lector que comienza a explorar esta lectura, los términos y símbolos matemáticos pueden parecer extraños o innecesariamente abstractos. Es importante aclarar desde el inicio que no se trata de nada más que <strong>notación básica de álgebra lineal</strong>, utilizada para describir algo muy familiar: <strong>tablas de datos</strong>.</p>
<p>En estas tablas, las <strong>columnas representan variables</strong> y las <strong>filas representan valores medidos sucesivamente</strong>, una observación tras otra. Esa tabla completa es lo que llamamos la matriz <span class="math inline">\(\boldsymbol{X}\)</span>.</p>
<p>Cada fila de esa matriz contiene todos los valores medidos en un instante, corrida u observación particular. En química analítica, a esto se le suele llamar una <em>corrida</em>. En estadística se le llama <em>observación</em>. En álgebra lineal, se le llama <em>vector</em>. En términos prácticos, todos estos términos describen exactamente lo mismo: <strong>una fila de la tabla de datos</strong>. Cada celda de esa fila es un dato individual.</p>
<p>Así, en términos de nomenclatura:</p>
<ul>
<li><p><span class="math inline">\(\boldsymbol{X}\)</span> es la <strong>matriz de datos completa</strong>,</p></li>
<li><p><span class="math inline">\(x_1, x_2, x_3, ... x_n\)</span> son los <strong>vectores</strong> (observaciones, corridas) que conforman la muestra multivariable, desde la primera hasta la última.</p></li>
</ul>
<p>La matriz <span class="math inline">\(\boldsymbol{X}\)</span> no es algo externo al proceso: <strong>ella es la muestra</strong>. Toda la información disponible sobre el estado del sistema fisicoquímico para construir nuestro <strong>procedimiento de control</strong> está contenida ahí.</p>
<p>Después del tratamiento por PCA, la información contenida en <span class="math inline">\(\boldsymbol{X}\)</span> se reorganiza en un nuevo conjunto de variables, los <strong>componentes principales</strong>, que denotamos como <span class="math inline">\(A\)</span>.</p>
<p>El lector sin experiencia previa no debe perder de vista lo esencial: <strong>la información que nos permite evaluar la estabilidad general de un proceso está contenida en la varianza</strong>. Todos los cambios fisicoquímicos de interés (reacciones, desviaciones operativas, degradaciones, fallas incipientes) se manifiestan inevitablemente como cambios en los datos, y esos datos siempre terminan organizados en una matriz.</p>
<p>Las variables originales viven en un <strong>espacio euclidiano</strong>, donde sus correlaciones y colinealidades están presentes y son visibles. Sin embargo, cuando aplicamos PCA, el análisis de datos y la calibración multivariable <strong>ya no ocurren en ese espacio original</strong>, sino en lo que se conoce como el <strong>espacio ortogonal</strong>.</p>
<p>En este nuevo espacio, las variables originales son reemplazadas por los componentes principales:</p>
<ul>
<li><span class="math inline">\(A_1, A_2, A_3... etc\)</span></li>
</ul>
<p>Cada uno de estos componentes contiene información de variación del proceso, cuantificada mediante su correspondiente <strong>eigenvalor</strong>:</p>
<ul>
<li><span class="math inline">\(\lambda_1, \lambda_2, \lambda_3... etc\)</span></li>
</ul>
<p>Cada eigenvalor representa cuánta varianza explica su componente principal asociado. Lo peculiar (y fundamental) es que <strong>los componentes principales no están correlacionados entre sí</strong>. Esta propiedad es precisamente la que hace a PCA tan atractivo y tan poderoso: el problema de la correlación entre variables prácticamente desaparece.</p>
<p>Más adelante veremos por qué esta característica es crítica para el monitoreo y control estadístico de procesos.</p>
<p>Desde un punto de vista operativo:</p>
<ul>
<li><p>Los <strong>scores</strong> pueden interpretarse como las magnitudes de cada una de las variables comprimidas <span class="math inline">\(A\)</span> para todas las observaciones <span class="math inline">\(N\)</span>. Es decir, describen cómo se comporta cada observación dentro del espacio PCA. Esta información está contenida en la matriz <span class="math inline">\(\boldsymbol{T}\)</span>.</p></li>
<li><p>Los <strong>loadings</strong>, por su parte, representan la traducción entre las variables originales <span class="math inline">\(M\)</span> de la matriz <span class="math inline">\(\boldsymbol{X}\)</span> y los componentes principales <span class="math inline">\(A\)</span>. Esta relación está contenida en la matriz <span class="math inline">\(\boldsymbol{P}\)</span>.</p></li>
</ul>
<p>En términos simples, los loadings describen <strong>cómo cada componente principal se expresa en función de las variables físicas originales</strong>. Son el puente matemático que conecta el espacio abstracto ortogonal con el sistema fisicoquímico material.</p>
<p>Esta transformación no elimina información ni la distorsiona. La reorganiza. Y esa reorganización es la condición necesaria para que el control estadístico multivariable sea matemáticamente válido, operacionalmente estable y científicamente confiable.</p>
<p>Desde esta perspectiva, PCA no destruye la información contenida en <span class="math inline">\(\boldsymbol{X}\)</span>, sino que la transforma a un espacio equivalente pero matemáticamente más manejable. Es una conversión desde el espacio original de mediciones físicas a un espacio abstracto donde la información se encuentra reorganizada y desacoplada.</p>
<p>En la implementación más común del algoritmo PCA se cumplen dos propiedades fundamentales:</p>
<ul>
<li>Los <em>loadings</em> de cada componente principal están normalizados y son ortogonales entre sí:</li>
</ul>
</section>
<section id="boldsymbolptp-i" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="boldsymbolptp-i"><span class="header-section-number">2.2</span> <span class="math display">\[
\boldsymbol{P^tP = I}
\]</span></h3>
<ul>
<li>Los <em>scores</em> de los componentes principales también son ortogonales entre sí, y su matriz de covarianzas está dada por:</li>
</ul>
</section>
<section id="fracmathbftmathsftmathbftn-1-operatornamediagboldsymbollambda" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="fracmathbftmathsftmathbftn-1-operatornamediagboldsymbollambda"><span class="header-section-number">2.3</span> <span class="math display">\[
\frac{\mathbf{T}^\mathsf{T}\mathbf{T}}{N-1}
=
\operatorname{diag}(\boldsymbol{\lambda})
\]</span></h3>
<p>donde <span class="math inline">\(\boldsymbol{I}\)</span> es la matriz de identidad y <span class="math inline">\(\boldsymbol{diag⁡(λ)}\)</span> es una matriz diagonal que contiene los <strong>autovalores</strong> (eigenvalues) de los componentes principales.</p>
</section>
</section>
<section id="qué-significa-todo-esto" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="qué-significa-todo-esto"><span class="header-section-number">3</span> ¿Qué significa todo esto?</h2>
<p>Vistas desde la estadística clásica, cada variable aporta una cantidad de varianza <span class="math inline">\(\sigma^2\)</span>.</p>
<p>De igual manera, cada autovalor <span class="math inline">\(\lambda_a\)</span>​ representa la cantidad de varianza de los datos originales, pero ahora explicada por el componente principal <span class="math inline">\(A\)</span>. Como es natural, la suma de todas las varianza, que en este caso son todos los autovalores, corresponde al 100 % de la varianza total del sistema. Así, un pequeño número de componentes principales puede capturar la mayor parte, o la totalidad de la variabilidad relevante del proceso. Toda la información que nos interesa analizar está contenida ahí.</p>
<p>¿Cómo?</p>
<p>Conceptualmente, cada variable original <span class="math inline">\(X_1, X_2, X_3,..., X_n\)</span> puede entenderse como un eje en un espacio euclidiano. Al contener muchas variables, se dice que este espacio es de alta dimensión. Algo que sucede de manera natural es que todas las correlaciones entre variables se preservan. Sin embargo, esa misma riqueza estructural introduce colinealidades que vuelven inestables e inválidos muchos modelos estadísticos y eso es justamente lo que obliga a proponer y explorar mecanismos alternativos para procesar y analizar y poder trabajar con nuestros datos en aploicaciones como la construcción de procedimientos de control estadístico. PCA actúa precisamente desacoplando las correlaciones entre estas dimensiones y reorganizando la información en un nuevo sistema de ejes ortogonales.</p>
<p>Al decir que “se busca desacoplar correlaciones entre variables” el lector rápidamente puede detectar que esto no tendría sentido físico e iría contra toda intuición científica: ¿para qué querríamos eliminar las correlaciones entre variables, si es precisamente allí donde se encuentra nuestra información?</p>
<p>Aunque las nuevas variables (los componentes principales) no tienen significado físico directo, esto no representa una desventaja ni una pérdida de información. Es simplemente el paso de una representación material a una representación matemática. Este diseño permite que los modelos estadísticos funcionen correctamente.</p>
<p>¿Cómo?</p>
<p>La información de la variación, magnitud, orientación y correlación pasa de estar contenida en cada variable original <span class="math inline">\(X_n\)</span>, a cada componente pricipal <span class="math inline">\(A\)</span>.</p>
</section>
<section id="cómo-ayuda-esto-al-monitoreo-y-control" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="cómo-ayuda-esto-al-monitoreo-y-control"><span class="header-section-number">4</span> ¿Cómo ayuda esto al monitoreo y control?</h2>
<p>En un contexto de monitoreo y control estadístico de procesos, el uso de PCA es crítico porque permite <strong>evitar el problema de intercorrelación</strong>. Utilizar componentes principales como variables de monitoreo en lugar de las variables originales en la matriz <span class="math inline">\(\boldsymbol{X}\)</span> impide:</p>
<ul>
<li><p>La inflación artificial de alarmas causada por variables correlacionadas que se desvían de manera coherente.</p></li>
<li><p>El enmascaramiento de fallas reales, donde desviaciones pequeñas pero coordinadas pasan desapercibidas en análisis univariables.</p></li>
<li><p>La violación de supuestos fundamentales de independencia requeridos por los estadísticos clásicos.</p></li>
<li><p>La pérdida de capacidad diagnóstica al no poder separar variaciones sistemáticas de ruido o de comportamientos fuera del modelo.</p></li>
<li><p>La dependencia excesiva del criterio subjetivo del operador para interpretar señales múltiples y contradictorias.</p></li>
</ul>
<p>En el espacio PCA, el comportamiento del proceso puede descomponerse formalmente en dos tipos de variación: la variación sistemática capturada por el modelo (medida típicamente con <span class="math inline">\(T^2\)</span>) y la variación no explicada por el modelo (medida con <span class="math inline">\(Q\)</span> o <strong>SPE</strong>). Esta separación es imposible sin compresión y ortogonalización.</p>
<p>Antes de PCA, el control se realiza sobre muchas variables colineales, con estadística inválida y resultados frágiles. Después de PCA, el control se realiza sobre pocas variables ortogonales, con estadística válida, interpretación clara y capacidad diagnóstica real.</p>
<p>No se trata de simplificar el proceso. Se trata de <strong>hacerlo visible</strong>.</p>
<p>No se trata de perder información. Se trata de <strong>organizarla de forma que el control estadístico funcione</strong> sin verse afectado por las covarianzas del sistema.</p>
<p>En este sentido, PCA no es una opción elegante ni una herramienta académica más. Es una <strong>condición necesaria</strong> para cualquier sistema serio de monitoreo y diagnóstico estadístico de procesos fisicoquímicos multivariables al operar con componentes principales en lugar de variables originales.</p>
</section>
<section id="los-residuales" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="los-residuales"><span class="header-section-number">5</span> Los residuales</h2>
<p>Cuando aplicamos métodos de compresión de datos y seleccionamos únicamente una fracción de la información disponible, esto implica necesariamente <strong>ignorar parte de la variación</strong> contenida en la matriz de datos originales <span class="math inline">\(\boldsymbol{X}\)</span>. Esa fracción de variación no modelada se almacena en la matriz de <strong>residuales</strong>, denotada como <span class="math inline">\(\boldsymbol{E}\)</span>.</p>
<p>Una vez calculada la matriz de <em>scores</em> estimados <span class="math inline">\(\boldsymbol{\hat{T}}\)</span> correspondiente a los componentes principales <span class="math inline">\(A\)</span> seleccionados, y la matriz de <em>loadings</em> estimados <span class="math inline">\(\boldsymbol{\hat{P}}\)</span> asociada a esos mismos componentes, los residuales (es decir, la parte de los datos que <strong>no es explicada por el modelo PCA</strong>) se estiman como:</p>
<section id="boldsymbolhate-x---hatthatpt" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="boldsymbolhate-x---hatthatpt"><span class="header-section-number">5.1</span> <span class="math display">\[
\boldsymbol{\hat{E} = X - \hat{T}\hat{P}^t}
\]</span></h3>
<p>Desde un punto de vista conceptual, esta ecuación expresa que los datos originales <span class="math inline">\(\boldsymbol{X}\)</span> se descomponen en dos partes:</p>
<ul>
<li><p><strong>Una parte modelada</strong>, capturada por el subespacio definido por los <span class="math inline">\(A\)</span> componentes principales seleccionados.</p></li>
<li><p><strong>Una parte no modelada</strong>, contenida en los residuales <span class="math inline">\(\boldsymbol{\hat{E}}\)</span>, que representa variación que el modelo PCA no explica.</p></li>
</ul>
</section>
</section>
<section id="el-problema-práctico-cuántos-componentes-conservar" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="el-problema-práctico-cuántos-componentes-conservar"><span class="header-section-number">6</span> El problema práctico: ¿cuántos componentes conservar?</h2>
<p>En la práctica, surge un desafío central: la decisión de <strong>cuántos componentes principales</strong> <span class="math inline">\(A\)</span> conservar en el modelo PCA. Esta decisión <strong>no es puramente objetiva</strong>. Aunque existen reglas heurísticas y criterios estadísticos ampliamente utilizados, la selección de <span class="math inline">\(A\)</span> sigue siendo, en esencia, una decisión de compromiso.</p>
<p>El objetivo de esta decisión es equilibrar dos necesidades contrapuestas:</p>
<ul>
<li><p><strong>Explicar la mayor cantidad posible de la variación</strong> contenida en los datos originales.</p></li>
<li><p><strong>Evitar la inclusión de ruido</strong> en el modelo, ya que incorporar demasiados componentes conduce inevitablemente al <strong>sobreajuste</strong>, es decir, a modelar variación aleatoria que no representa comportamiento estructural del proceso.</p></li>
</ul>
<p>Un modelo PCA con pocos componentes puede resultar insuficiente y dejar fuera información relevante del proceso. En cambio, un modelo con demasiados componentes pierde su capacidad de generalización y se vuelve sensible al ruido, lo cual degrada su valor como herramienta de monitoreo y diagnóstico.</p>
<p>Esta tensión entre <strong>explicación y parsimonia</strong> es inherente a todos los modelos empíricos multivariables y constituye uno de los puntos críticos en la construcción de calibraciones quimiométricas robustas.</p>
</section>
<section id="el-principal-beneficio-de-pca-en-el-control-estadístico-de-procesos-fisicoquímicos-multivariables" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="el-principal-beneficio-de-pca-en-el-control-estadístico-de-procesos-fisicoquímicos-multivariables"><span class="header-section-number">7</span> El principal beneficio de PCA en el control estadístico de procesos fisicoquímicos multivariables</h2>
<p>En su uso tradicional (y limitado) PCA suele emplearse como una herramienta exploratoria en contextos genéricos de “ciencia de datos”, sin explotar sus capacidades diagnósticas más potentes.</p>
<p>Sin embargo, en un contexto de <strong>diagnóstico fisicoquímico aplicado al control estadístico de procesos multivariables</strong>, gobernados por sensores, actuadores electrónicos y tecnologías analíticas de proceso (PAT), PCA se convierte en una <strong>herramienta de predicción de la estabilidad del proceso de transformación fisicoquímica</strong>.</p>
<p>Un caso típico de esta aplicación ocurre cuando se desea determinar si los datos obtenidos <strong>en tiempo presente</strong> son aceptables o inaceptables al compararlos contra un conjunto de referencia utilizado para construir una <strong>calibración multivariable</strong>.</p>
<p>Las decisión es simple porque es binaria: si los datos son aceptables, el proceso continúa. De lo contrario, se requiere intervención.</p>
</section>
<section id="cómo-se-realiza-este-procedimiento" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="cómo-se-realiza-este-procedimiento"><span class="header-section-number">8</span> ¿Cómo se realiza este procedimiento?</h2>
<p>El enfoque correcto consiste en construir un modelo PCA utilizando una cantidad suficiente de observaciones multivariables provenientes de un conjunto de datos de referencia que represente condiciones operativas normales del proceso y cuya producción cumpla con los criterios de conformidad del producto.</p>
<p>Una vez construido el modelo, este se aplica a nuevas corridas de datos <span class="math inline">\(\boldsymbol{x}\)</span>​ conocidas individualmente como el <strong>“<em>perfil analítico</em>”</strong> y que son generadas conforme el proceso continúa en operación.</p>
<p>Este procedimiento exige una secuencia de pasos bien definida, es decir, un <strong>algoritmo</strong> y que se puede programar fácilmente en una computadora.</p>
<section id="preprocesamiento-del-nuevo-vector" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="preprocesamiento-del-nuevo-vector"><span class="header-section-number">8.1</span> Preprocesamiento del nuevo vector</h3>
<p>Cada nuevo vector de observación debe ser preprocesado mediante <strong>autoescalamiento</strong>. El procedimiento consiste en restar el vector medio <span class="math inline">\(\boldsymbol{\bar{x}}\)</span> y dividir entre el vector de desviaciones estándar <span class="math inline">\(\boldsymbol{s}\)</span>, para obtener:</p>
</section>
<section id="boldsymbolx_p-fracx---barxs" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="boldsymbolx_p-fracx---barxs"><span class="header-section-number">8.2</span> <span class="math display">\[
\boldsymbol{x_p = \frac{x - \bar{x}}s}
\]</span></h3>
</section>
<section id="proyección-al-espacio-pca" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="proyección-al-espacio-pca"><span class="header-section-number">8.3</span> Proyección al espacio PCA</h3>
<p>El siguiente paso es proyectar el nuevo vector escalado <span class="math inline">\(\boldsymbol{x}_p\)</span>​ al espacio del modelo PCA mediante los <em>loadings</em> <span class="math inline">\(\boldsymbol{P}\)</span>:</p>
</section>
<section id="boldsymbolhatt_p-boldsymbolx_pboldsymbolp" class="level3" data-number="8.4">
<h3 data-number="8.4" class="anchored" data-anchor-id="boldsymbolhatt_p-boldsymbolx_pboldsymbolp"><span class="header-section-number">8.4</span> <span class="math display">\[
\boldsymbol{\hat{t}_p} = \boldsymbol{x_p}\boldsymbol{P}
\]</span></h3>
<p>En álgebra lineal, esta operación se conoce como la <strong>proyección de la observación al subespacio PCA</strong>.</p>
</section>
<section id="reconstrucción-y-cálculo-del-residual" class="level3" data-number="8.5">
<h3 data-number="8.5" class="anchored" data-anchor-id="reconstrucción-y-cálculo-del-residual"><span class="header-section-number">8.5</span> Reconstrucción y cálculo del residual</h3>
<p>Una vez obtenidos los <em>scores</em> proyectados y contenidos en el vector <span class="math inline">\(\boldsymbol{\hat{t}_p}\)</span>, nuestro algoritmo ahora calcula la respuesta <span class="math inline">\(\boldsymbol{\hat{x}_p}\)</span> estimada por el modelo PCA:</p>
</section>
<section id="boldsymbolhatx_p-boldsymbolhatt_pboldsymbolp" class="level3" data-number="8.6">
<h3 data-number="8.6" class="anchored" data-anchor-id="boldsymbolhatx_p-boldsymbolhatt_pboldsymbolp"><span class="header-section-number">8.6</span> <span class="math display">\[ \boldsymbol{\hat{x}_p} = \boldsymbol{\hat{t}_p}\boldsymbol{P} \]</span></h3>
<p>El residual <span class="math inline">\(\boldsymbol{\hat{e}_p}\)</span> asociado a la nueva observación se obtiene entonces como:</p>
</section>
<section id="boldsymbolhate_p-x_p---hatx_p" class="level3" data-number="8.7">
<h3 data-number="8.7" class="anchored" data-anchor-id="boldsymbolhate_p-x_p---hatx_p"><span class="header-section-number">8.7</span> <span class="math display">\[
\boldsymbol{\hat{e}_p = x_p - \hat{x}_p}
\]</span></h3>
<p>Conceptualmente, el residual representa la porción de la medición multivariable que el modelo PCA <strong>no puede explicar</strong>. Si el modelo explicara también esta fracción, estaría modelando ruido y conduciría inevitablemente al sobreajuste.</p>
</section>
</section>
<section id="métricas-de-diagnóstico-t2-y-q" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="métricas-de-diagnóstico-t2-y-q"><span class="header-section-number">9</span> Métricas de diagnóstico: <span class="math inline">\(T^2\)</span> y <span class="math inline">\(Q\)</span></h2>
<p>El propósito de estos cálculos es reconocer que tanto los <em>scores</em> <span class="math inline">\(\boldsymbol{\hat{t}}_p\)</span>​ como los residuales <span class="math inline">\(\boldsymbol{\hat{e}}_p\)</span> constituyen <strong>métricas de predicción</strong>. A partir de ellos se construyen dos estadísticos fundamentales para la evaluación de la calidad y la detección válida de anomalías en procesos fisicoquímicos.</p>
<section id="estadístico-t2-de-hotelling" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="estadístico-t2-de-hotelling"><span class="header-section-number">9.1</span> Estadístico <span class="math inline">\(T^2\)</span> de Hotelling</h3>
<p>En aplicaciones industriales de transformaciones fisicoquímicas (tal como se presenta en la literatura quimiométrica especializada) el estadístico <span class="math inline">\(T^2\)</span> adopta una forma que, aunque algebraicamente equivalente a la definición clásica de la estadística multivariable genérica, resulta operacionalmente más adecuada para su implementación en sistemas de monitoreo. Puede expresarse de dos maneras equivalentes:</p>
</section>
<section id="boldsymbolt2-hatt_p-diaglambda-1-hattt_p" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="boldsymbolt2-hatt_p-diaglambda-1-hattt_p"><span class="header-section-number">9.2</span> <span class="math display">\[ \boldsymbol{T^2 = \hat{t}_p * diag(\lambda)^{-1} * \hat{t}^t_p} \]</span></h3>
<p>y, de forma escalar,</p>
</section>
<section id="boldsymbolt2-sigmaa_a1-fract2_alambda_a" class="level3" data-number="9.3">
<h3 data-number="9.3" class="anchored" data-anchor-id="boldsymbolt2-sigmaa_a1-fract2_alambda_a"><span class="header-section-number">9.3</span> <span class="math display">\[ \boldsymbol{T^2 = \Sigma^A_{a=1} \frac{t^2_a}{\lambda_a}} \]</span></h3>
<p>donde <span class="math inline">\(\lambda_a\)</span>​ representa la varianza asociada al componente principal <span class="math inline">\(A\)</span>.</p>
</section>
<section id="estadístico-de-residuales-q" class="level3" data-number="9.4">
<h3 data-number="9.4" class="anchored" data-anchor-id="estadístico-de-residuales-q"><span class="header-section-number">9.4</span> Estadístico de residuales <span class="math inline">\(Q\)</span></h3>
<p>De manera análoga, el estadístico de residuales <span class="math inline">\(Q\)</span> (también conocido como <em>Squared Prediction Error</em> (SPE)) puede definirse de dos formas equivalentes:</p>
</section>
<section id="boldsymbolq-hate_p-hatet_p" class="level3" data-number="9.5">
<h3 data-number="9.5" class="anchored" data-anchor-id="boldsymbolq-hate_p-hatet_p"><span class="header-section-number">9.5</span> <span class="math display">\[ \boldsymbol{Q = \hat{e}_p *\hat{e}^t_p} \]</span></h3>
<p>o bien,</p>
</section>
<section id="boldsymbolq-sigmaj_j1-e2_ij" class="level3" data-number="9.6">
<h3 data-number="9.6" class="anchored" data-anchor-id="boldsymbolq-sigmaj_j1-e2_ij"><span class="header-section-number">9.6</span> <span class="math display">\[ \boldsymbol{Q = \Sigma^J_{j=1} {e^2_{ij}}} \]</span></h3>
</section>
<section id="interpretación-conjunta" class="level3" data-number="9.7">
<h3 data-number="9.7" class="anchored" data-anchor-id="interpretación-conjunta"><span class="header-section-number">9.7</span> Interpretación conjunta</h3>
<p>Desde un punto de vista conceptual, el estadístico <span class="math inline">\(T^2\)</span> mide la <strong>lejanía multivariable de una observación dentro del subespacio modelado por el PCA</strong>, mientras que el estadístico <span class="math inline">\(Q\)</span> cuantifica la <strong>cantidad de variación que queda fuera de dicho subespacio</strong>, comúnmente interpretada como falta de ajuste.</p>
<p>Es completamente válido interpretar la varianza total de un sistema estocástico como una suma que representa el 100% de la información disponible. En este sentido, los estadísticos <span class="math inline">\(T^2\)</span> y <span class="math inline">\(Q\)</span> capturan <strong>fracciones complementarias de esa misma varianza total</strong>. No se trata de omitir información, sino precisamente de <strong>procesarla en su totalidad</strong>.</p>
<p>Por esta razón, ambos estadísticos son necesarios para una evaluación completa de las anomalías detectables durante la operación del proceso:</p>
<ul>
<li><p><span class="math inline">\(T^2\)</span> concentra toda la variación <strong>dentro</strong> del modelo PCA,</p></li>
<li><p>mientras que <span class="math inline">\(Q\)</span> captura toda la variación que queda <strong>fuera</strong> de él.</p></li>
</ul>
</section>
</section>
<section id="límites-de-confianza-y-lanzamiento-del-procedimiento-de-control" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="límites-de-confianza-y-lanzamiento-del-procedimiento-de-control"><span class="header-section-number">10</span> Límites de confianza y lanzamiento del procedimiento de control</h2>
<p>Antes de operar un modelo PCA como herramienta de monitoreo, es <strong>necesario y obligatorio</strong> establecer límites de confianza que funcionen como <strong>límites de control</strong> para ambos estadísticos de diagnóstico: <span class="math inline">\(T^2\)</span> y <span class="math inline">\(Q\)</span>.</p>
<p>Existen diversos métodos para determinar estos límites; sin embargo, en términos generales, todos requieren dos elementos fundamentales:</p>
<ul>
<li><p>Los valores de <span class="math inline">\(T^2\)</span> y <span class="math inline">\(Q\)</span> obtenidos a partir del conjunto de calibración, es decir, de datos que representan condiciones operativas aceptables del proceso.</p></li>
<li><p>La especificación explícita del nivel de confianza deseado (95%, 99%, 99.9%, etc.), el cual es definido por el cliente en función del compromiso requerido entre <strong>sensibilidad</strong> (capacidad de detección de anomalías) y <strong>especificidad</strong> (evitar falsas alarmas) del sistema de monitoreo.</p></li>
</ul>
<p>Una vez que estos límites han sido calibrados y que la robustez del modelo PCA ha sido validada, el modelo puede desplegarse formalmente como un <strong>procedimiento de control estadístico multivariable</strong>, capaz de detectar outliers en tiempo real durante la operación normal del proceso.</p>
<p>La obra de J. Edward Jackson, <em>A User’s Guide to Principal Components</em>, resulta particularmente ilustrativa en este contexto para los profesionales de la química industrial aplicada. El propio Jackson reconoce que gran parte del desarrollo práctico de estas metodologías surgió durante su trabajo en la industria química de Kodak desde la década de los 40s, en estrecha colaboración con <strong>químicos interesados en el desarrollo de herramientas estadísticas avanzadas, para aplicarlas al control y mejora de la calidad de productos químicos.</strong></p>
<p>Jackson enfatiza que el límite de control del estadístico <span class="math inline">\(T^2\)</span> está íntimamente relacionado con la distribución de probabilidad <span class="math inline">\(F\)</span>, y se calcula como:</p>
<section id="boldsymbolt2_p-n-alpha-fracpn-1n---p-f_p-n-p-alpha" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="boldsymbolt2_p-n-alpha-fracpn-1n---p-f_p-n-p-alpha"><span class="header-section-number">10.1</span> <span class="math display">\[
\boldsymbol{T^2_{p, n, \alpha} = \frac{p(n-1)}{n - p} F_{p, n-p, \alpha}}
\]</span></h3>
<p>donde <span class="math inline">\(\boldsymbol{p}\)</span> es el número de componentes principales retenidos en el modelo, <span class="math inline">\(\boldsymbol{n}\)</span> es el número de observaciones de calibración y <span class="math inline">\(\boldsymbol{\alpha}\)</span> es el nivel de significancia seleccionado.</p>
<p>De manera análoga, Jackson presenta la expresión para el valor crítico del estadístico residual <span class="math inline">\(\boldsymbol{Q}\)</span>:</p>
</section>
<section id="boldsymbolq_alpha-theta_1-fracc_alphasqrt2theta_2h2_0theta_1-fractheta_2h_0h_0-1theta2_1-1th_0" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="boldsymbolq_alpha-theta_1-fracc_alphasqrt2theta_2h2_0theta_1-fractheta_2h_0h_0-1theta2_1-1th_0"><span class="header-section-number">10.2</span> <span class="math display">\[
\boldsymbol{Q_\alpha = \theta_1 [\frac{c_\alpha\sqrt{2\theta_2h^2_0}}{\theta_1} +\frac{\theta_2h_0(h_0-1)}{\theta^2_1} + 1]^{t/h_0}}
\]</span></h3>
<p>donde los términos <span class="math inline">\(\boldsymbol{\theta_1}\)</span>​, <span class="math inline">\(\boldsymbol{\theta_2}\)</span>​ y <span class="math inline">\(\boldsymbol{h_0}\)</span>​ dependen de los eigenvalores no incluidos en el modelo, y <span class="math inline">\(\boldsymbol{c_\alpha}\)</span>​ es un valor crítico asociado a una distribución aproximadamente normal.</p>
<p>Jackson hace una aclaración particularmente relevante desde el punto de vista industrial: la aproximación normal de <span class="math inline">\(\boldsymbol{c_\alpha}\)</span>​ es válida <strong>independientemente de si se han incluido o no todos los componentes principales estadísticamente significativos</strong> en el modelo PCA. Esta propiedad refuerza de manera decisiva la utilidad práctica del estadístico <span class="math inline">\(\boldsymbol{Q}\)</span> como una métrica robusta para el monitoreo de procesos reales, donde la <strong>parsimonia del modelo</strong> es tan importante como su <strong>capacidad de detección</strong>.</p>
<p>En conjunto, estos límites de confianza constituyen el paso final que coloca a los modelos PCA en su debido y justo lugar: dejan de ser un simple “<em>algoritmo de aprendizaje no supervisado</em>”, una desafortunada descripción que surge de la perspectiva reduccionista de la popularmente llamada <em>ciencia de datos</em>. En ese ámbito, los modelos PCA suelen interpretarse como un procedimiento intermedio y arcaico, una herramienta descriptiva primitiva de patrones pero no de conclusiones, en la que el significado material y la interpretabilidad de los datos supuestamente “se pierden”.</p>
<p>Para la industria química, en cambio, los modelos PCA se revelan y prevalecen como lo que verdaderamente son: <strong>sistemas analíticos formales de datos de medición para el control estadístico multivariable de procesos fisicoquímicos</strong>, matemáticamente trazables, operacionalmente robustos y plenamente auditables, precisamente porque están rigurosamente fundamentados en el álgebra lineal.</p>
<p>Los algoritmos genéricos de <em>machine learning</em> promovidos desde la ciencia de datos no pueden ofrecer un nivel comparable de escrutinio metodológico ni de trazabilidad matemática.</p>
<p>Se trata, en el caso del PCA, de sistemas diseñados con transparencia para su despliegue y monitoreo continuo en entornos industriales reales, capaces de informar (observación tras observación) la estabilidad operativa de las relaciones vinculantes entre todas las variables del proceso.</p>
<p>No existe un método más riguroso, transparente y libre de cajas negras para asegurar la calidad del producto y garantizar la satisfacción del cliente.</p>
</section>
</section>
<section id="el-diagnóstico-de-causas-raíz" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="el-diagnóstico-de-causas-raíz"><span class="header-section-number">11</span> El diagnóstico de causas raíz</h2>
<p>No obstante, para que un procedimiento de control estadístico multivariable sea verdaderamente completo, es indispensable atender la siguiente pregunta fundamental:</p>
<p><strong>¿Cuál o cuáles variables causaron la desviación observada?</strong></p>
<p>El mecanismo quimiométrico diseñado específicamente para responder esta pregunta son las <strong>contribuciones</strong> <span class="math inline">\(t\)</span> y las <strong>contribuciones</strong> <span class="math inline">\(q\)</span>.</p>
<p>Es precisamente en este punto donde el proceso deja de comportarse como una <em>caja negra</em> (como ocurre con muchos algoritmos de <em>machine learning</em>) y comienza a <strong>explicarse a sí mismo</strong>, proporcionando información diagnóstica interpretable desde el punto de vista fisicoquímico.</p>
<p>Es importante aclarar que, en el desarrollo de modelos PCA para el control estadístico multivariable de procesos fisicoquímicos, existen <strong>dos tipos claramente diferenciados de outliers</strong>:</p>
<ol type="1">
<li><p><strong>Outliers presentes durante la etapa de calibración del modelo</strong>, los cuales pueden conducir al desarrollo de modelos multivariables subóptimos si no son identificados y tratados adecuadamente.</p></li>
<li><p><strong>Outliers detectados durante la etapa de operación (despliegue) del modelo</strong>, los cuales pueden resultar igual o incluso más dañinos.</p></li>
</ol>
<p>Esto último ocurre porque cualquier resultado de predicción será necesariamente <strong>inválido</strong> al obtenerlo tras aplicar un modelo empírico a una nueva observación que proviene de un <strong>estado fisicoquímico extraño</strong>, es decir, <strong>no representado y por tanto desconocido</strong> en los datos de calibración.</p>
<p>Cualquier intento de aplicar un modelo de calibración multivariable a observaciones nuevas en tales estados inapropiados resultará en predicciones <strong>evidentemente inexactas</strong>.</p>
<p>Como consecuencia, es crítico evaluar continuamente si las muestras provenientes del proceso de transformación son <strong>aptas para su uso con el modelo empírico</strong>. En modelos construidos mediante PCA, PLS, PCR u otros métodos basados en factores latentes, el mecanismo convencional para este tipo de <em>monitores de salud del modelo</em> se encuentra <strong>intrínsecamente incorporado en el propio modelo de calibración</strong>.</p>
<p>Tanto durante la calibración como durante la operación del método, un valor anormalmente elevado del estadístico <span class="math inline">\(T^2\)</span> indica que la observación exhibe una conducta irregular que <strong>aún reside dentro del espacio multivariado del modelo</strong>, pero en una región distante de las observaciones típicas que definen el modelo de calibración PCA contra el cual se comparan las nuevas observaciones generadas por el proceso.</p>
<p>En contraste, un valor residual <span class="math inline">\(Q\)</span> anormalmente elevado indica que la observación contiene <strong>información significativamente distinta</strong> a la capturada por el modelo PCA de calibración, es decir, información que <strong>no puede ser explicada por los componentes principales retenidos</strong>.</p>
<p>En cualquiera de ambos casos, cualquier resultado generado a partir de una observación que presente valores elevados de <span class="math inline">\(T^2\)</span> y/o <span class="math inline">\(Q\)</span> debe considerarse una <strong>predicción inválida</strong>.</p>
<p>Durante la operación real de procesos industriales, el número de observaciones multivariables fácilmente supera las decenas o centenas. Dado el volumen de cálculo involucrado, el tiempo limitado disponible y la inevitable presencia de error humano, <strong>su monitoreo debe ser automatizado mediante software especializado</strong>. Nunca debe realizarse de forma manual ni con plantillas configuradas en software genérico de hojas de cálculo. El riesgo de error en el cómputo y de configuraciones frágiles en el diseño del algoritmo es demasiado elevado.</p>
<p>El uso de <span class="math inline">\(T^2\)</span> y <span class="math inline">\(Q\)</span> como métricas para la detección de outliers en el control estadístico de procesos multivariables fisicoquímicos constituye un claro ejemplo de <strong>monitores de salud del sistema bajo observación</strong>. Estas métricas emergen directamente de un modelo de predicción (ya sea PCA, PLS o PCR) y establecen el estándar cuantitativo contra el cual cada nueva observación es comparada, permitiendo una decisión binaria: <strong>aceptar o rechazar la observación</strong>, y actuar en consecuencia.</p>
<p>Por esta razón, en quimiometría, <span class="math inline">\(T^2\)</span> y <span class="math inline">\(Q\)</span> son consideradas las <strong>métricas de élite en la detección de anomalías</strong>.</p>
<p>Adicionalmente, para cualquier nueva observación que produzca valores elevados o sospechosos de <span class="math inline">\(T^2\)</span> y/o <span class="math inline">\(Q\)</span>, es posible calcular las <strong>contribuciones individuales de cada variable fisicoquímica</strong> que impactan dichos estadísticos. Estas reciben el nombre de <strong>contribuciones</strong> <span class="math inline">\(t\)</span> y <strong>contribuciones</strong> <span class="math inline">\(q\)</span>, cuyas definiciones son:</p>
<section id="boldsymbolt_cont-hatt_p-lambda12-pt" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="boldsymbolt_cont-hatt_p-lambda12-pt"><span class="header-section-number">11.1</span> <span class="math display">\[
\boldsymbol{t_{cont} = \hat{t}_p \lambda^{1/2} P^t}
\]</span></h3>
</section>
<section id="boldsymbolq_cont-hate_p" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="boldsymbolq_cont-hate_p"><span class="header-section-number">11.2</span> <span class="math display">\[
\boldsymbol{q_{cont} = \hat{e}_p}
\]</span></h3>
<p>Estas contribuciones resultan particularmente útiles para evaluar la <strong>naturaleza específica de la causa (o causas) de la anomalía</strong> detectada durante el monitoreo del proceso.</p>
<p>El objetivo es único y claro:</p>
<p><strong>Si se desea determinar la naturaleza específica o las causas raíz de observaciones anómalas, entonces las contribuciones</strong> <span class="math inline">\(t\)</span> y <span class="math inline">\(q\)</span> asociadas a aquellas lecturas donde se observaron valores elevados de <span class="math inline">\(T^2\)</span> y <span class="math inline">\(Q\)</span> proporcionan la información diagnóstica más poderosa y útil disponible actualmente en la ciencia quimiométrica.</p>
</section>
</section>
<section id="conclusión" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="conclusión"><span class="header-section-number">12</span> Conclusión</h2>
<p>Tras esta exposición, el lector podría concluir que el rigor matemático aquí presentado pertenece exclusivamente al ámbito académico o al ejercicio teórico dentro del aula. Ese criterio es incorrecto.</p>
<p>Nada de lo expuesto corresponde a una teoría fisicoquímica. Todo el desarrollo presentado constituye, en realidad, la base estrictamente matemático-estadística necesaria para construir algoritmos programables destinados a la producción de software de monitoreo en tiempo real. En ese contexto, la aplicación resuelve el único problema industrial que verdaderamente importa:</p>
<p><strong>El aseguramiento objetivo y continuo de la calidad del producto para la satisfacción del cliente.</strong></p>
<p>Esto exige la definición de una regla de decisión clara, binaria y auditable:</p>
<p><strong>Aceptación o rechazo de una observación, y la identificación de sus causas.</strong></p>
<p>¿Y qué hace que dicha decisión sea auditable?</p>
<ol type="1">
<li>La trazabilidad matemática completa del método que da origen al modelo.</li>
<li>La expresión gráfica y visual que permite rapidez y claridad intuitiva al tomar cada decisión.</li>
</ol>
<p>Fundamentar y demostrar cada decisión tomada bajo un mecanismo que permita justificarla sin ambigüedades, sin arbitrariedades y sin subjetividades es lo que protege la reputación profesional. No existe otra forma. (Si el lector conoce alguna alternativa igualmente rigurosa, le pedimos que nos la haga saber; nos interesaría enormemente conocerla).</p>
<p>Por esta razón, en un contexto de control estadístico multivariable de procesos, los algoritmos genéricos de <em>machine learning</em> no constituyen una opción responsable ni científica: al operar como cajas negras, el escrutinio de la interacción entre variables queda oculto, y la rendición de cuentas con transparencia metodológica se vuelve imposible.</p>
<p>Esto no significa que los algoritmos de <em>machine learning</em> ofrecidos por la ciencia de datos carezcan de utilidad industrial. Todo lo contrario: su capacidad predictiva puede ser notable. Su limitación fundamental es otra: <strong>no son matemáticamente transparentes, ni pueden serlo</strong>, porque no han sido diseñados con ese propósito.</p>
<p>Al final, el lector elige:</p>
<ul>
<li><p>metodologías multivariables reconocidas, trazables y abiertas;</p></li>
<li><p>metodologías multivariables novedosas, genéricas y cerradas;</p></li>
<li><p>o una combinación consciente y responsable de ambas.</p></li>
</ul>
<p>Por estas razones, esta exposición no debe interpretarse como un ejercicio teórico-académico, sino como lo que realmente es:</p>
<p><strong>Una metodología estrictamente aplicada para la industria de transformaciones fisicoquímicas</strong>, diseñada para operar procesos reales bajo condiciones reales, con criterios objetivos, reproducibles, defendibles y plenamente auditables.</p>
<p>Invitamos al lector a enviarnos sus comentarios, preguntas y sugerencias.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>